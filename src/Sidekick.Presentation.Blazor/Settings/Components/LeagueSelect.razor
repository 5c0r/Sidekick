@using Sidekick.Domain.Game.Leagues.Queries

<MudSelect T="string"
           Label="@Localizer[SettingsResources.Character_League]"
           Variant="Variant.Filled"
           Value="Value"
           ValueChanged="ValueChanged">
    @foreach (var option in Options)
    {
        <MudSelectItem Value="@option.Key">@option.Value</MudSelectItem>
    }
</MudSelect>

@code {
    [Inject] private IStringLocalizer<SettingsResources> Localizer { get; set; }
    [Inject] private IMediator Mediator { get; set; }

    [Parameter] public string Value { get; set; }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }

    private Dictionary<string, string> Options { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await RefreshOptions();

        await base.OnInitializedAsync();
    }

    public async Task RefreshOptions()
    {
        var leagues = await Mediator.Send(new GetLeaguesQuery(true));
        if (leagues != null)
        {
            Options = leagues.ToDictionary(x => x.Id, x => x.Text);
        }
        else
        {
            Options = new Dictionary<string, string>();
        }
    }
}
